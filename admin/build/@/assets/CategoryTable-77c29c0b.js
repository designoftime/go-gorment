import{r as j,S as W,u as X,j as e,d as o,L as q}from"./index-f6a288a5.js";import{S as Z,I as y}from"./Layout-3cab380e.js";import{T as ee,C as se,S as ae}from"./BulkActionDrawer-a4f81489.js";import{C as P,T as $,D as te,u as ne,M as re}from"./DrawerButton-c44c3727.js";import{D as le,E as ie}from"./EditDeleteButton-52071107.js";import{T as de}from"./ParentCategory-cf116562.js";import{a as B,n as z}from"./toast-428049c5.js";import{u as oe,E as K}from"./index.esm-c3a9b1de.js";import{I as me}from"./InputArea-10443e58.js";import{L}from"./LabelArea-a7059c0a.js";import{S as pe}from"./SwitchToggle-a80f4933.js";import{U as ce}from"./Uploader-37ef10f9.js";import{u as xe}from"./useTranslationValue-29029aa6.js";import{u as Y}from"./useUtilsFunction-10febe6f.js";const ue=(i,m)=>{const{isDrawerOpen:n,closeDrawer:f,setIsUpdate:p,lang:v}=j.useContext(W),[C,T]=j.useState({}),[N,w]=j.useState(""),[D,c]=j.useState(""),[_,s]=j.useState([]),[r,g]=j.useState(v),[d,I]=j.useState(!0),[A,E]=j.useState(""),[U,S]=j.useState(!1),{handlerTextTranslateHandler:H}=xe(),{register:t,handleSubmit:x,setValue:a,clearErrors:u,reset:F,formState:{errors:k}}=oe(),G=async({name:h,description:l})=>{var M,R;try{S(!0);const b=await H(h,r),Q=await H(l,r),V={name:{[r]:h,...b},description:{[r]:l||"",...Q},parentId:N||void 0,parentName:A||"Home",icon:D,status:d?"show":"hide",lang:r};if(i){const O=await P.updateCategory(i,V);p(!0),S(!1),z(O.message),f(),F()}else{const O=await P.addCategory(V);p(!0),S(!1),z(O.message),f()}}catch(b){S(!1),B(b?(R=(M=b==null?void 0:b.response)==null?void 0:M.data)==null?void 0:R.message:b==null?void 0:b.message),f()}},J=h=>{g(h),Object.keys(C).length>0&&(a("name",C.name[h||"en"]),a("description",C.description[h||"en"]))};return j.useEffect(()=>{var h;if(!n){T({}),a("name"),a("parentId"),a("parentName"),a("description"),a("icon"),c(""),I(!0),u("name"),u("parentId"),u("parentName"),u("description"),E("Home"),g(v),a("language",r),m!==void 0&&((h=m[0])==null?void 0:h._id)!==void 0&&w(m[0]._id);return}i&&(async()=>{try{const l=await P.getCategoryById(i);l&&(T(l),a("name",l.name[r||"en"]),a("description",l.description[r||"en"]),a("language",r),a("parentId",l.parentId),a("parentName",l.parentName),E(l.parentName),w(l.parentId),c(l.icon),I(l.status==="show"))}catch(l){B(l?l.response.data.message:l.message)}})()},[i,a,n,r,u,m,v]),{register:t,handleSubmit:x,onSubmit:G,errors:k,imageUrl:D,setImageUrl:c,children:_,setChildren:s,published:d,setPublished:I,checked:N,setChecked:w,isSubmitting:U,selectCategoryName:A,setSelectCategoryName:E,handleSelectLanguage:J}},he=({id:i,data:m})=>{const{t:n}=X(),{checked:f,register:p,onSubmit:v,handleSubmit:C,errors:T,imageUrl:N,setImageUrl:w,published:D,setPublished:c,setChecked:_,selectCategoryName:s,setSelectCategoryName:r,handleSelectLanguage:g,isSubmitting:d}=ue(i,m),{showingTranslateValue:I}=Y(),A=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,E={motionName:"node-motion",motionAppear:!1,onAppearStart:t=>({height:0}),onAppearActive:t=>({height:t.scrollHeight}),onLeaveStart:t=>({height:t.offsetHeight}),onLeaveActive:()=>({height:0})},U=t=>{let x=[];for(let a of t)x.push({title:I(a.name),key:a._id,children:a.children.length>0&&U(a.children)});return x},S=(t,x)=>{var a;return t._id===x?t:(a=t==null?void 0:t.children)==null?void 0:a.reduce((u,F)=>u??S(F,x),void 0)},H=async t=>{if(t!==void 0)if(i){const x=await P.getCategoryById(t);if(i===t)return B("This can't be select as a parent category!");if(i===x.parentId)return B("This can't be select as a parent category!");{if(t===void 0)return;_(t);const a=m[0],u=S(a,t);r(I(u==null?void 0:u.name))}}else{if(t===void 0)return;_(t);const x=m[0],a=S(x,t);r(I(a==null?void 0:a.name))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:i?e.jsx($,{register:p,handleSelectLanguage:g,title:n("UpdateCategory"),description:n("UpdateCategoryDescription")}):e.jsx($,{register:p,handleSelectLanguage:g,title:n("AddCategoryTitle"),description:n("AddCategoryDescription")})}),e.jsx(Z,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:C(v),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(me,{register:p,label:"Category title",name:"name",type:"text",placeholder:n("ParentCategoryPlaceholder")}),e.jsx(K,{errorName:T.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(ee,{required:!0,register:p,label:"Description",name:"description",type:"text",placeholder:"Category Description"}),e.jsx(K,{errorName:T.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(o.Input,{readOnly:!0,...p("parent",{required:!1}),name:"parent",value:s||"Home",placeholder:n("ParentCategory"),type:"text"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:A}}),e.jsx(de,{expandAction:"click",treeData:U(m),selectedKeys:[f],onSelect:t=>H(t[0]),motion:E,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ce,{imageUrl:N,setImageUrl:w,folder:"category"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(pe,{handleProcess:c,processOption:D})})]})]}),e.jsx(te,{id:i,title:"Category",isSubmitting:d})]})})]})},Ee=({data:i,lang:m,isCheck:n,categories:f,setIsCheck:p,useParamId:v,showChild:C})=>{const{title:T,serviceId:N,handleModalOpen:w,handleUpdate:D}=ne(),{showingTranslateValue:c}=Y(),_=s=>{const{id:r,checked:g}=s.target;p([...n,r]),g||p(n.filter(d=>d!==r))};return e.jsxs(e.Fragment,{children:[(n==null?void 0:n.length)<1&&e.jsx(le,{useParamId:v,id:N,title:T}),e.jsx(re,{children:e.jsx(he,{id:N,data:i,lang:m})}),e.jsx(o.TableBody,{children:f==null?void 0:f.map(s=>{var r,g;return e.jsxs(o.TableRow,{children:[e.jsx(o.TableCell,{children:e.jsx(se,{type:"checkbox",name:"category",id:s._id,handleClick:_,isChecked:n==null?void 0:n.includes(s._id)})}),e.jsx(o.TableCell,{className:"font-semibold uppercase text-xs",children:(r=s==null?void 0:s._id)==null?void 0:r.substring(20,24)}),e.jsx(o.TableCell,{children:s!=null&&s.icon?e.jsx(o.Avatar,{className:"hidden mr-3 md:block bg-gray-50 p-1",src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}):e.jsx(o.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product",className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none"})}),e.jsx(o.TableCell,{className:"font-medium text-sm ",children:(s==null?void 0:s.children.length)>0?e.jsxs(q,{to:`/categories/${s==null?void 0:s._id}`,className:"text-blue-700",children:[c(s==null?void 0:s.name),e.jsx(e.Fragment,{children:C&&e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{className:"pl-2 ",children:(g=s==null?void 0:s.children)==null?void 0:g.map(d=>e.jsx("div",{children:e.jsx(q,{to:`/categories/${d==null?void 0:d._id}`,className:"text-blue-700",children:e.jsxs("div",{className:"flex text-xs items-center  text-blue-800",children:[e.jsx("span",{className:" text-xs text-gray-500 pr-1",children:e.jsx(y,{})}),e.jsx("span",{className:"text-gray-500",children:c(d.name)})]})})},d._id))})]})})]}):e.jsx("span",{children:c(s==null?void 0:s.name)})}),e.jsx(o.TableCell,{className:"text-sm",children:c(s==null?void 0:s.description)}),e.jsx(o.TableCell,{className:"text-center",children:e.jsx(ae,{id:s._id,category:!0,status:s.status})}),e.jsx(o.TableCell,{children:e.jsx(ie,{id:s==null?void 0:s._id,parent:s,isCheck:n,children:s==null?void 0:s.children,handleUpdate:D,handleModalOpen:w,title:c(s==null?void 0:s.name)})})]},s._id)})})]})};export{he as C,Ee as a};
