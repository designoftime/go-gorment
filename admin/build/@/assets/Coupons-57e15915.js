import{r as h,S as $,j as e,t as m,d as l,u as W}from"./index-91256b8b.js";import{l as X,d as ee,e as se,f as le}from"./Layout-8f5051d9.js";import{a as U,D as q,E as ae}from"./EditDeleteButton-6d60ea96.js";import{u as te}from"./SettingServices-80f1e0b4.js";import{T as L,D as re,u as Z,M as G}from"./DrawerButton-e4f12f23.js";import{u as ie}from"./useFilter-b9c3a979.js";import{P as ne}from"./PageTitle-c22abfd4.js";import{C as J,S as de,B as oe}from"./BulkActionDrawer-0b41669f.js";import{u as me,E as F}from"./index.esm-23aa3917.js";import{I as O}from"./InputArea-eea18a09.js";import{I as H}from"./InputValue-8b28fd9c.js";import{L as A}from"./LabelArea-6b2bbec0.js";import{U as ce}from"./Uploader-6e2f045b.js";import{d as R}from"./index-229836e9.js";import{a as z,n as Y}from"./toast-3ee14540.js";import{u as xe}from"./useTranslationValue-51bff073.js";import{u as K}from"./useUtilsFunction-ee0d7fef.js";import{S as pe}from"./TextAreaCom-319187e2.js";import{a as ge}from"./index.prod-88b37547.js";import{T as ue}from"./TableLoading-e94bed9d.js";import{N as he}from"./NotFound-a9ca6293.js";import{U as je}from"./UploadManyTwo-ec66b00c.js";import"./iconBase-38ad006b.js";import"./spinner-f39505bc.js";import"./AdminServices-e9d01b98.js";import"./httpService-ff296925.js";import"./LanguageServices-dc0f24a7.js";import"./CurrencyServices-4cb29ecf.js";import"./Tooltip-b5459989.js";import"./SelectLanguageTwo-e2368231.js";import"./browser-c871b2f1.js";import"./ParentCategory-97ae94c6.js";import"./tslib.es6-1fe07526.js";import"./exportFromJSON-59a1cb7c.js";const be=a=>{const{isDrawerOpen:r,closeDrawer:j,setIsUpdate:i,lang:n}=h.useContext($),[T,b]=h.useState(""),[x,f]=h.useState(n),[y,p]=h.useState({}),[g,w]=h.useState(!1),[N,s]=h.useState(!1),[u,c]=h.useState(!1),{handlerTextTranslateHandler:v}=xe(),{currency:D}=K(),{register:B,handleSubmit:I,setValue:d,clearErrors:S,formState:{errors:M}}=me(),E=async o=>{var k,P;try{c(!0);const C=await v(o.title,x),t={title:{[x]:o.title,...C},couponCode:o.couponCode,endTime:o.endTime,minimumAmount:o.minimumAmount,logo:T,lang:x,status:g?"show":"hide",discountType:{type:N?"percentage":"fixed",value:o.discountPercentage},productType:o.productType};if(a){const _=await U.updateCoupon(a,t);i(!0),c(!1),Y(_.message),j()}else{const _=await U.addCoupon(t);i(!0),c(!1),Y(_.message),j()}}catch(C){z(C?(P=(k=C==null?void 0:C.response)==null?void 0:k.data)==null?void 0:P.message:C.message),c(!1),j()}},V=o=>{f(o),Object.keys(y).length>0&&d("title",y.title[o||"en"])};return h.useEffect(()=>{if(!r){p({}),d("title"),d("productType"),d("couponCode"),d("endTime"),d("discountPercentage"),d("minimumAmount"),b(""),S("title"),S("productType"),S("couponCode"),S("endTime"),S("discountPercentage"),S("minimumAmount"),f(n),d("language",x);return}a&&(async()=>{var o,k,P,C;try{const t=await U.getCouponById(a);t&&(p(t),d("title",t.title[x||"en"]),d("productType",t.productType),d("couponCode",t.couponCode),d("endTime",R(t.endTime).format("YYYY-MM-DD HH:mm")),d("discountPercentage",(o=t.discountType)==null?void 0:o.value),d("minimumAmount",t.minimumAmount),w(t.status==="show"),s(((k=t.discountType)==null?void 0:k.type)==="percentage"),b(t.logo))}catch(t){z(t?(C=(P=t==null?void 0:t.response)==null?void 0:P.data)==null?void 0:C.message:t.message)}})()},[a,d,r,S,x,n]),{register:B,handleSubmit:I,onSubmit:E,errors:M,setImageUrl:b,imageUrl:T,published:g,setPublished:w,currency:D,discountType:N,isSubmitting:u,setDiscountType:s,handleSelectLanguage:V}},fe=({title:a,handleProcess:r,processOption:j,product:i,handleIsCombination:n})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:`${i?"mb-3 flex flex-wrap justify-end items-center mr-8":"mb-3"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[i?e.jsx("label",{className:"block text-base font-normal text-orange-500 dark:text-orange-400 mx-4",children:"Does this product have variants?"}):e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:a}),e.jsx(ge,{onChange:i?n:r,checked:j,className:"react-switch",uncheckedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingRight:45,paddingTop:1},children:"Fixed"}),width:125,height:33,handleDiameter:28,offColor:"#E53E3E",onColor:"#2F855A",checkedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingLeft:50,paddingTop:1},children:"Percentage"})})]})})}),Q=({id:a})=>{const{register:r,handleSubmit:j,onSubmit:i,errors:n,setImageUrl:T,imageUrl:b,published:x,setPublished:f,currency:y,discountType:p,setDiscountType:g,isSubmitting:w,handleSelectLanguage:N}=be(a);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative  p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 ",children:a?e.jsx(L,{register:r,handleSelectLanguage:N,title:m("UpdateCoupon"),description:m("UpdateCouponDescription")}):e.jsx(L,{register:r,handleSelectLanguage:N,title:m("AddCoupon"),description:m("AddCouponDescription")})}),e.jsx(X.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:j(i),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CouponBannerImage")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ce,{imageUrl:b,setImageUrl:T,folder:"coupon"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CampaignName")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{register:r,label:"Coupon title",name:"title",type:"text",placeholder:m("CampaignName")}),e.jsx(F,{errorName:n.title})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CampaignCode")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{register:r,label:"Coupon Code",name:"couponCode",type:"text",placeholder:m("CampaignCode")}),e.jsx(F,{errorName:n.couponCode})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("CouponValidityTime")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(l.Input,{...r("endTime",{required:"Coupon Validation End Time"}),label:"Coupon Validation End Time",name:"endTime",type:"datetime-local",placeholder:m("CouponValidityTime")}),e.jsx(F,{errorName:n.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("DiscountType")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(fe,{handleProcess:g,processOption:p}),e.jsx(F,{errorName:n.discountType})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("Discount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{product:!0,register:r,maxValue:p?99:1e3,minValue:1,label:"Discount",name:"discountPercentage",type:"number",placeholder:p?"Percentage":"Fixed Amount",currency:p?"%":y}),e.jsx(F,{errorName:n.discountPercentage})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("MinimumAmount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{product:!0,register:r,maxValue:2e5,minValue:100,label:"Minimum Amount",name:"minimumAmount",type:"number",placeholder:m("MinimumAmountPlasholder"),currency:y}),e.jsx(F,{errorName:n.minimumAmount})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:m("Published")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(pe,{handleProcess:f,processOption:x}),e.jsx(F,{errorName:n.productType})]})]})]}),e.jsx(re,{id:a,title:"Coupon",isSubmitting:w})]})})]})},ye=({isCheck:a,coupons:r,setIsCheck:j})=>{const[i,n]=h.useState([]),{title:T,serviceId:b,handleModalOpen:x,handleUpdate:f}=Z(),{currency:y,showDateFormat:p,globalSetting:g,showingTranslateValue:w}=K(),N=s=>{const{id:u,checked:c}=s.target;j([...a,u]),c||j(a.filter(v=>v!==u))};return h.useEffect(()=>{const s=r==null?void 0:r.map(u=>{const c=new Date(u==null?void 0:u.updatedAt).toLocaleString("en-US",{timeZone:g==null?void 0:g.default_time_zone});return{...u,updatedDate:c}});n(s)},[r,g==null?void 0:g.default_time_zone]),e.jsxs(e.Fragment,{children:[a.length<1&&e.jsx(q,{id:b,title:T}),a.length<2&&e.jsx(G,{children:e.jsx(Q,{id:b})}),e.jsx(l.TableBody,{children:i==null?void 0:i.map((s,u)=>{var c,v,D,B,I;return e.jsxs(l.TableRow,{children:[e.jsx(l.TableCell,{children:e.jsx(J,{type:"checkbox",name:(c=s==null?void 0:s.title)==null?void 0:c.en,id:s._id,handleClick:N,isChecked:a==null?void 0:a.includes(s._id)})}),e.jsxs(l.TableCell,{children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.logo?e.jsx(l.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:s==null?void 0:s.logo,alt:"product"}):e.jsx(l.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:w(s==null?void 0:s.title)})," "]})]})," "]}),e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm",children:[" ",s.couponCode]})," "]}),(v=s==null?void 0:s.discountType)!=null&&v.type?e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold",children:[" ",((D=s==null?void 0:s.discountType)==null?void 0:D.type)==="percentage"?`${(B=s==null?void 0:s.discountType)==null?void 0:B.value}%`:`${y}${(I=s==null?void 0:s.discountType)==null?void 0:I.value}`]})," "]}):e.jsxs(l.TableCell,{children:[" ",e.jsx("span",{className:"text-sm font-semibold",children:" "})," "]}),e.jsx(l.TableCell,{className:"text-center",children:e.jsx(de,{id:s._id,status:s.status})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:p(s.startTime)})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:p(s.endTime)})}),e.jsx(l.TableCell,{className:"align-middle ",children:R().isAfter(R(s.endTime))?e.jsx(l.Badge,{type:"danger",children:"Expired"}):e.jsx(l.Badge,{type:"success",children:"Active"})}),e.jsx(l.TableCell,{children:e.jsx(ae,{id:s==null?void 0:s._id,isCheck:a,handleUpdate:f,handleModalOpen:x,title:w(s==null?void 0:s.title)})})]},u+1)})})]})},ss=()=>{const{t:a}=W(),{toggleDrawer:r,lang:j}=h.useContext($),{data:i,loading:n,error:T}=te(U.getAllCoupons),[b,x]=h.useState(!1),[f,y]=h.useState([]),{allId:p,serviceId:g,handleDeleteMany:w,handleUpdateMany:N}=Z(),{filename:s,isDisabled:u,couponRef:c,dataTable:v,serviceData:D,totalResults:B,resultsPerPage:I,handleChangePage:d,handleSelectFile:S,setSearchCoupon:M,handleSubmitCoupon:E,handleUploadMultiple:V,handleRemoveSelectFile:o}=ie(i),k=()=>{x(!b),y(i==null?void 0:i.map(C=>C._id)),b&&y([])},P=()=>{M(""),c.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:a("CouponspageTitle")}),e.jsx(q,{ids:p,setIsCheck:y,title:"Selected Coupon"}),e.jsx(oe,{ids:p,title:"Coupons"}),e.jsx(G,{children:e.jsx(Q,{id:g})}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:E,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6  xl:flex",children:[e.jsx("div",{className:"flex justify-start xl:w-1/2  md:w-full",children:e.jsx(je,{title:"Coupon",exportData:i,filename:s,isDisabled:u,handleSelectFile:S,handleUploadMultiple:V,handleRemoveSelectFile:o})}),e.jsxs("div",{className:"lg:flex  md:flex xl:justify-end xl:w-1/2  md:w-full md:justify-start flex-grow-0",children:[e.jsx("div",{className:"w-full md:w-40 lg:w-40 xl:w-40 mr-3 mb-3 lg:mb-0",children:e.jsxs(l.Button,{disabled:f.length<1,onClick:()=>N(f),className:"w-full rounded-md h-12 btn-gray text-gray-600",children:[e.jsx("span",{className:"mr-2",children:e.jsx(ee,{})}),a("BulkAction")]})}),e.jsx("div",{className:"w-full md:w-32 lg:w-32 xl:w-32 mr-3 mb-3 lg:mb-0",children:e.jsxs(l.Button,{disabled:f.length<1,onClick:()=>w(f),className:"w-full rounded-md h-12 bg-red-500 btn-red",children:[e.jsx("span",{className:"mr-2",children:e.jsx(se,{})}),a("Delete")]})}),e.jsx("div",{className:"w-full md:w-48 lg:w-48 xl:w-48",children:e.jsxs(l.Button,{onClick:r,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(le,{})}),a("AddCouponsBtn")]})})]})]})})}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:E,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:c,type:"search",placeholder:a("SearchCoupon")})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Filter"})}),e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{layout:"outline",onClick:P,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Reset"})})})]})]})})}),n?e.jsx(ue,{row:12,col:8,width:140,height:20}):T?e.jsx("span",{className:"text-center mx-auto text-red-500",children:T}):(D==null?void 0:D.length)!==0?e.jsxs(l.TableContainer,{className:"mb-8",children:[e.jsxs(l.Table,{children:[e.jsx(l.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(l.TableCell,{children:e.jsx(J,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:k,isChecked:b})}),e.jsx(l.TableCell,{children:a("CoupTblCampaignsName")}),e.jsx(l.TableCell,{children:a("CoupTblCode")}),e.jsx(l.TableCell,{children:a("Discount")}),e.jsx(l.TableCell,{className:"text-center",children:a("catPublishedTbl")}),e.jsx(l.TableCell,{children:a("CoupTblStartDate")}),e.jsx(l.TableCell,{children:a("CoupTblEndDate")}),e.jsx(l.TableCell,{children:a("CoupTblStatus")}),e.jsx(l.TableCell,{className:"text-right",children:a("CoupTblActions")})]})}),e.jsx(ye,{lang:j,isCheck:f,coupons:v,setIsCheck:y})]}),e.jsx(l.TableFooter,{children:e.jsx(l.Pagination,{totalResults:B,resultsPerPage:I,onChange:d,label:"Table navigation"})})]}):e.jsx(he,{title:"Sorry, There are no coupons right now."})]})};export{ss as default};
